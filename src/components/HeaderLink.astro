---
import type { HTMLAttributes } from 'astro/types';

type Props = HTMLAttributes<'a'>;

const { href, class: className, ...props } = Astro.props;

// 1. Define la URL base para el despliegue (ej: /acastrolab/)
const BASE_PATH = import.meta.env.BASE_URL.endsWith('/')
    ? import.meta.env.BASE_URL
    : import.meta.env.BASE_URL + '/';

// 2. Determina el HREF final (para enlaces internos, externos o anclajes)
let finalHref: string;

if (href.startsWith('#') || href.includes('://')) {
    // Si es un ANCLAJE (#about) o una URL EXTERNA, se usa directamente sin modificar.
    finalHref = href;
} else {
    // Si es una RUTA INTERNA (/about/), añade el BASE_PATH.
    finalHref = BASE_PATH + href.substring(1);
}

// 3. Lógica para determinar si el enlace está ACTIVO (solo para rutas de archivo)
// Se obtiene la ruta actual sin el BASE_PATH (ej: /about/)
const pathname = Astro.url.pathname.replace(import.meta.env.BASE_URL, ''); 

// El enlace está activo si: 
// a) No es un anclaje (#)
// b) El pathname actual empieza con el href del enlace (ej: /about/ vs /about/post/1)
const isActive = href !== '#' && pathname.startsWith(href);
---

<a href={finalHref} class:list={[className, { active: isActive }]} {...props} translate="no">
    <slot />
</a>
